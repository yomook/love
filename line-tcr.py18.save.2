# -*- coding: utf-8 -*-

import LINETCR
from LINETCR.lib.curve.ttypes import *
from io import StringIO
from datetime import datetime
import time,random,sys,json,codecs,threading,glob,sys
import re,string,os
import os.path,sys,urllib,shutil,subprocess

cl = LINETCR.LINE()
cl.login(qr=True)
cl.loginResult()

ki = LINETCR.LINE()
ki.login(qr=True)
ki.loginResult()

kk = LINETCR.LINE()
kk.login(qr=True)
kk.loginResult()  

ks = LINETCR.LINE() 
ks.login(qr=True)
ks.loginResult()  

kc = kk 
ka = ks
cl
        
print "login success"
reload(sys)
sys.setdefaultencoding('utf-8')
helpMessage ="""âœ¨Å¤á»‚Ã„Îœ Î²Ç¾Å¦ ðŸ”±à°¬á€”à¸°Ê¨à¸²à¥­ðŸ”â„œà¦¨à¸±Î©á€”à°¬á€”á€”à®‡â„œ                 

ðŸƒ[Id]: ~Ã·~
ðŸƒ[Mid]: ~Ã·~
ðŸƒ[All mid]:
ðŸƒ[Me]: ~Ã·~
ðŸ‘Š[K1/K2/K3/]: "Contact"
ðŸ‘Š[K1/K2/K3 fuck:]: "Kick kicker"
ðŸƒ[Group Id]: "Id Me Group"
ðŸƒ[TL : "Text"]: "Auto status TL"
ðŸƒ[Clock :]: "Name Clock"
ðŸƒ[Up clock]: "Up date Clock"
ðŸƒ[Name : 'text']: "Name me"
ðŸƒ[MIC]: "mid"]: "Contact share"
ðŸ‘Š[à¸¥à¸šà¸£à¸±à¸™]: " invite"]: 
ðŸ‘Š[Massage add: "text"]: ~Ã·~
ðŸ‘Š[Add confirmasi]: ~Ã·~
ðŸ‘Š[Comment set : "Text"]: ~Ã·~
ðŸ‘Š[Comment check]: ~Ã·~
ðŸ‘Š[Clock: on]: "Clock name on"
ðŸ‘Š[Clock: off]: "Clock name off"
ðŸ‘Š[Ban]: "Add blacklist"
ðŸ‘Š[Unban]: "Dalate blacklist"
ðŸ‘Š[Banlist]: "Check blacklist"
ðŸ‘Š[à¹à¸—à¸„]         
ðŸ‘Š[Kicker join]
ðŸ‘Š[à¸¡à¸­à¸‡]
ðŸ‘Š[à¹€à¸«à¹‡à¸™]
ðŸ‘Š[Kick] 

-âš â„¢[Æ§Ð„Æ¬]:Æ‡Æ MMÆ›ÆÆŠÆ§ Æ§Ð„Æ¬. -
ðŸ‘Š[Contact: on/off]: 
ðŸ‘Š[Auto join: on/off]: 
ðŸ‘Š[Cancel Invite: 1 on/off]:
ðŸ‘Š[Auto share: on/off]:
ðŸ‘Š[Auto leave: on/off]: 
ðŸ‘Š[Comment: on/off]: 
ðŸ‘Š[Auto add: on/off]: 
ðŸ‘Š[Auto like: on/off]: 
	
-âš â„¢Æ‡Æ MMÆ›ÆÆŠÆ§ Æ–Æ Æ¬HÐ„ Æ“Æ¦Æ Æ²Æ¤Æ§. ~~~~
ðŸ‘Š[Ban " @Tag]: 
ðŸ‘Š[Unban " @Tag]: 
ðŸ‘Š[Urlon]: "Open urL"
ðŸ‘Š[Urloff]: "Closed urL"
ðŸ‘Š[Url]: " Check urL room"
ðŸ‘Š[Ginfo]: "~Ã·~ data room"
ðŸ‘Š[Invite: "mid"]: 
ðŸ‘Š[Say: "Text"]: "Kicker talk"
ðŸ‘Š[Cancel]: "Cancel invite"
ðŸ‘Š[Gn: "name"]: "Change name Group"
ðŸ‘Š[NK: "Name"]: ~Ã·~
ðŸ‘Š[Dead]: "Kick Blacklist"

âœ¨Å¤á»‚Ã„Îœ Î²Ç¾Å¦ ðŸ”±à°¬á€”à¸°Ê¨à¸²à¥­ðŸ”â„œà¦¨à¸±Î©á€”à°¬á€”á€”à®‡â„œ 

"""              
helpMessage2 ="""âœ¨Å¤á»‚Ã„Îœ Î²Ç¾Å¦ ðŸ”±à°¬á€”à¸°Ê¨à¸²à¥­ðŸ”â„œà¦¨à¸±Î©á€”à°¬á€”á€”à®‡â„œ 

ðŸ‘Š[Æ¤Æ¦Æ Æ¬Ð„Æ‡Æ¬: Æ Æ/Æ Æ‘Æ‘]: 
ðŸ‘Š[ÆÔ¼Æ Æ‡Æ˜ Æ²Æ¦Ô¼: Æ Æ/Æ Æ‘Æ‘]: 
ðŸ‘Š[ÆÆ›MÐ„Ô¼Æ Æ‡Æ˜: Æ Æ/Æ Æ‘Æ‘]: 
ðŸ‘Š[ÆÔ¼Æ Æ‡Æ˜Æ–ÆÆ”Æ–Æ¬Ð„: Æ Æ/Æ Æ‘Æ‘]:  
	
"""
KAC = [cl,ki,kk,ks,kc,ka]
mid = cl.getProfile().mid
Amid = ki.getProfile().mid
kimid = kk.getProfile().mid
ki2mid = ks.getProfile().mid
Cmid = kc.getProfile().mid
Emid = ka.getProfile().mid
admin = ["u8df6961f127bb94882c4eb1294ecf9e3"]
me = cl.getProfile().mid
bot1 = cl.getProfile().mid
main = cl.getProfile().mid
kicker1 = ki.getProfile().mid
bots = me + kicker1
protectname = []
protecturl = []
protection = []
autocancel = {}
autoinvite = []
autoleaveroom = []

admins = ["ub736c5b1794f5aa30026d162d07ce5e6"]
Rx5 = ["u406133ad4d3fbe50a2f4d51ea081d050"]
Rx4 = ["u406133ad4d3fbe50a2f4d51ea081d050"]
Rx3 = ["u406133ad4d3fbe50a2f4d51ea081d050"]
Rx2 = ["ua51ba06b0dd18c0bfe2cc6caa3458202"]
Rx1 = ["uc7f32bb28dc009916d40af87c9910ddc"]
Administrator = admins + Rx5 + Rx4 + Rx3 + Rx2 + Rx1
AS = Rx2 + Rx1 + Rx3 + Rx4 + Rx5
adminsA = admins + Rx3 + Rx5

omikuzi = ["å¤§å‰","ä¸­å‰","å°å‰","æœ«å‰","å¤§å‡¶","å‡„1¤7"]

wait = {
    'contact':False,
    'autoJoin':True,
    'autoCancel':{"on":True,"members":1},
    'leaveRoom':False,
    'timeline':False,
    'autoAdd':False,
    'message':"à¹à¸­à¸”à¸¡à¸²à¸£à¸±à¸à¸«à¸£à¸·à¸­à¹à¸­à¸”à¸¡à¸²à¸£à¸±à¸™à¸„à¸£à¸±à¸š",
    "lang":"JP",
    "comment":"Auto like By.âœ¨Å¤á»‚Ã„Îœ Î²Ç¾Å¦ ðŸ”±à°¬á€”à¸°Ê¨à¸²à¥­ðŸ”â„œà¦¨à¸±Î©á€”à°¬á€”á€”à®‡â„œ  ",
    "likeOn":False,
    "commentOn":False,
    "commentBlack":{},
    "wblack":False,
    "dblack":False,
    "clock":False,
    "blacklist":{}, 
    "wblacklist":False,
    "pnharfbot":{},
    "pname":{},
    "pro_name":{},    
    "dblacklist":False
}

wait2 = {
	'readMember':{},
	'readPoint':{},
	'ROM':{},
	'setTime':{}
    }
	
setTime = {}
setTime = wait2["setTime"]

res = {
    'num':{},
    'us':{},
    'au':{},
}

def Cmd(string, commands): #/XXX, >XXX, ;XXX, ^XXX, %XXX, $XXX...
    tex = [""]
    for texX in tex:
        for command in commands:
            if string ==texX + command:
                return True
    return False
    
def sendMessage(to, text, contentMetadata={}, contentType=0):
    mes = Message()
    mes.to, mes.from_ = to, profile.mid
    mes.text = text
    mes.contentType, mes.contentMetadata = contentType, contentMetadata
    if to not in messageReq:
        messageReq[to] = -1
    messageReq[to] += 1
         
def bot(op):
    try:
        if op.type == 0:
            return
        if op.type == 5:
            if wait["autoAdd"] == True:
                cl.findAndAddContactsByMid(op.param1)
                if (wait["message"] in [""," ","\n",None]):
                    pass
                else:
                    cl.sendText(op.param1,str(wait["message"]))
        if op.type == 13:
            if mid in op.param3:
                G = cl.getGroup(op.param1)
                if wait["autoJoin"] == True:
                    if wait["autoCancel"]["on"] == True:
                        if len(G.members) <= wait["autoCancel"]["members"]:
                            cl.rejectGroupInvitation(op.param1)
                        else:
                            cl.acceptGroupInvitation(op.param1)
                    else:
                        cl.acceptGroupInvitation(op.param1)
                elif wait["autoCancel"]["on"] == True:
                    if len(G.members) <= wait["autoCancel"]["members"]:
                        cl.rejectGroupInvitation(op.param1)
            else:
                Inviter = op.param3.replace("",',')
                InviterX = Inviter.split(",")
                matched_list = []
                for tag in wait["blacklist"]:
                    matched_list+=filter(lambda str: str == tag, InviterX)
                if matched_list == []:
                    pass
                else:
                    cl.cancelGroupInvitation(op.param1, matched_list)
                    kk.cancelGroupInvitation(op.param1, matched_list)
                    ks.cancelGroupInvitation(op.param1, matched_list)
                    
        if op.type == 17:
            if mid in op.param3:
                    group = cl.getGroup(msg.to)
                    gMembMids = [contact.mid for contact in group.members]
                    matched_list = []
                    for tag in wait["blacklist"]:
                        matched_list+=filter(lambda str: str == tag, gMembMids)
                    if matched_list == []:
                        cl.sendText(msg.to,"There was no blacklist user")
                        return
                    for jj in matched_list:
                        cl.kickoutFromGroup(msg.to,[jj])
                    cl.sendText(msg.to,"Blacklist user flushing is complete")

        if op.type == 11:
            if op.param3 == '1':
                if op.param1 in wait['pname']:
                    try:
                        G = cl.getGroup(op.param1)
                    except:
                        try:
                            G = ki.getGroup(op.param1)
                        except:
                            try:
                                G = kk.getGroup(op.param1)
                            except:
                                try:
                                    G = ks.getGroup(op.param1)
                                except:
                                    try:
                                        G = ki.getGroup(op.param1)
				    except:
					try:
                                            G = kc.getGroup(op.param1)
                                        except:
                                            pass
                    G.name = wait['pro_name'][op.param1]
                    try:
                        cl.updateGroup(G)
                    except:
                        try:
                            ki.updateGroup(G)
                        except:
                            try:
                                kk.updateGroup(G)
                            except:
                                try:
                                    ks.updateGroup(G)
                                except:
                                    try:
                                        kc.updateGroup(G)
                                    except:
                                        try:
                                            ka.updateGroup(G)
                                        except:
                                            pass
                    if op.param2 in ken:
                        pass
                    else:
                        try:
                            koutFromGroup(op.param1,[op.param2])
                        except:
                            try:
                                kk.kickoutFromGroup(op.param1,[op.param2])
                            except:
                                try:
                                    kc.kickoutFromGroup(op.param1,[op.param2])
                                except:
                                    try:
                                        ka.kickoutFromGroup(op.param1,[op.param2])
                                    except:
                                        try:
                                            ks.kickoutFromGroup(op.param1,[op.param2])
                                        except:
                                            pass
                                        cl.sendText(op.param1,"Group name lock")
                                        ki.sendText(op.param1,"Haddeuh dikunci Pe'a")
                                        kk.sendText(op.param1,"Wekawekaweka ô€œô€…”Har Harô¿¿")
                                        c = Message(to=op.param1, from_=None, text=None, contentType=13)
                                        c.contentMetadata={'mid':op.param2}
                                        cl.sendMessage(c)
        if op.type == 19:
            if mid in op.param3:
                wait["blacklist"][op.param2] = True
		if op.type == 17:
			if mid in op.param3:
				if wait["blacklist"] == True:
					cl.kickoutFromGroup(op.param1,[op.param2])
					ki.kickoutFromGroup(op.param1,[op.param2])
					kk.kickoutFromGroup(op.param1,[op.param2])
					ks.kickoutFromGroup(op.param1,[op.param2])
		if op.type == 32:
			if mid in op.param3:
				wait["blacklist"][op.param2] == True
		if op.type == 32:
			if mid in op.param3:
				if wait["blacklist"] == True:
					cl.kickoutFromGroup(op.param1,[op.param2])
					ki.kickoutFromGroup(op.param1,[op.param2])
					kk.kickoutFromGroup(op.param1,[op.param2])
					ks.kickoutFromGroup(op.param1,[op.param2])
		if op.type == 25:
			if mid in op.param3:
				wait["blacklist"][op.param2] == True
		if op.type == 25:
			if mid in op.param3:
				if wait["blacklist"] == True:
					cl.kickoutFromGroup(op.param1,[op.param2])
					ki.kickoutFromGroup(op.param1,[op.param2])
					kk.kickoutFromGroup(op.param1,[op.param2])
					ks.kickoutFromGroup(op.param1,[op.param2])
        if op.type == 22:
            if wait["leaveRoom"] == True:
                cl.leaveRoom(op.param1)
        if op.type == 24:
            if wait["leaveRoom"] == True:
                cl.leaveRoom(op.param1)
        if op.param3 == "4":
            if op.param1 in protecturl:
				group = cl.getGroup(op.param1)
				if group.preventJoinByTicket == False:
					group.preventJoinByTicket = True
					cl.updateGroup(group)
					cl.sendText(op.param1,"URL can not be changed")
					ki.kickoutFromGroup(op.param1,[op.param2])
					kk.kickoutFromGroup(op.param1,[op.param2])
					ks.kickoutFromGroup(op.param1,[op.param2])
					wait["blacklist"][op.param2] = True
					f=codecs.open('st2__b.json','w','utf-8')
					json.dump(wait["blacklist"], f, sort_keys=True, indent=4,ensure_ascii=False)
				else:
					pass                
        if op.type == 26:
            msg = op.message
            if msg.toType == 0:
                msg.to = msg.from_
                if msg.from_ == "u7c6053763344625bb1159355020c5c27":
                    if "join:" in msg.text:
                        list_ = msg.text.split(":")
                        try:
                            cl.acceptGroupInvitationByTicket(list_[1],list_[2])
                            ki.acceptGroupInvitationByTicket(list_[1],list_[2])
                            kk.acceptGroupInvitationByTicket(list_[1],list_[2])
                            ks.acceptGroupInvita		
                            X = cl.getGroup(list_[1])
                            X = ki.getGroup(list_[1])
                            X = kk.getGroup(list_[1])
                            X = ks.getGroup(list_[1])							
                            X.preventJoinByTicket = True
                            cl.updateGroup(X)
                            ki.updateGroup(X)
                            kk.updateGroup(X)
                            ks.updateGroup(X)							
                        except:
                            cl.sendText(msg.to,"error")
            if msg.toType == 1:
                if wait["leaveRoom"] == True:
                    cl.leaveRoom(msg.to)
            if msg.contentType == 16:
                url = msg.contentMetadata["postEndUrl"]
                cl.like(url[25:58], url[66:], likeType=1002)                    
        if op.type == 25:
            msg = op.message
            if msg.contentType == 13:
                if wait["wblack"] == True:
                    if msg.contentMetadata["mid"] in wait["commentBlack"]:
                        cl.sendText(msg.to,"It's included in a blacklist alreadyã€„1¤7")
                        wait["wblack"] = False
                    else:
                        wait["commentBlack"][msg.contentMetadata["mid"]] = True
                        wait["wblack"] = False
                        cl.sendText(msg.to,"I decided not to make a commentã€„1¤7")
                elif wait["dblack"] == True:
                    if msg.contentMetadata["mid"] in wait["commentBlack"]:
                        del wait["commentBlack"][msg.contentMetadata["mid"]]
                        cl.sendText(msg.to,"It was eliminated from a blacklistã€„1¤7")
                        wait["dblack"] = False
                    else:
                        wait["dblack"] = False
                        cl.sendText(msg.to,"It isn't included in a blacklistã€„1¤7")
                elif wait["wblacklist"] == True:
                    if msg.contentMetadata["mid"] in wait["blacklist"]:
                        cl.sendText(msg.to,"It's included in a blacklist already.ã€„1¤7")